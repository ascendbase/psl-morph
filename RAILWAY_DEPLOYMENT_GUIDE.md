# üöÄ Railway Deployment Guide - Face Morphing SaaS

This guide will help you deploy your Face Morphing SaaS app to Railway with PostgreSQL database and persistent storage.

## üìã Prerequisites

1. **GitHub Repository**: Your code must be in a GitHub repository
2. **Railway Account**: Sign up at [railway.app](https://railway.app)
3. **RunPod RTX 5090**: Your GPU instance should be running
4. **Environment Variables**: Prepare your configuration values

## üéØ Step-by-Step Deployment

### Step 1: Prepare Your Repository

1. **Push to GitHub** (if not already done):
```bash
git add .
git commit -m "Ready for Railway deployment"
git push origin main
```

2. **Verify Deployment Files** (already configured):
- ‚úÖ `deployment/Dockerfile`
- ‚úÖ `deployment/railway.toml`
- ‚úÖ `deployment/Procfile`
- ‚úÖ `requirements.txt`

### Step 2: Create Railway Project

1. **Go to Railway**: Visit [railway.app](https://railway.app)
2. **Sign in with GitHub**: Connect your GitHub account
3. **New Project**: Click "New Project"
4. **Deploy from GitHub repo**: Select your Face Morphing repository
5. **Choose Branch**: Select `main` branch

### Step 3: Add PostgreSQL Database

1. **In your Railway project**: Click "New Service"
2. **Add Database**: Select "PostgreSQL"
3. **Wait for deployment**: Database will be automatically configured
4. **Note**: Railway will auto-generate `DATABASE_URL` environment variable

### Step 4: Configure Environment Variables

In your Railway project settings, add these environment variables:

#### Required Variables:
```bash
# Production Settings
ENVIRONMENT=production
DEBUG=False
SECRET_KEY=your-super-secret-key-change-this-in-production

# Database (Auto-generated by Railway PostgreSQL)
DATABASE_URL=postgresql://... (automatically set)

# GPU Configuration
USE_CLOUD_GPU=true
USE_RUNPOD_POD=true
RUNPOD_POD_URL=your-runpod-proxy-url
RUNPOD_POD_PORT=8188

# Security
LOGIN_DISABLED=false

# Optional: Logging
LOG_LEVEL=INFO
```

#### How to Set Environment Variables:
1. Go to your Railway project dashboard
2. Click on your service (web app)
3. Go to "Variables" tab
4. Add each variable with its value
5. Click "Add" for each one

### Step 5: Update Database Configuration

Railway uses PostgreSQL instead of SQLite. Your app is already configured to handle this automatically via the `DATABASE_URL` environment variable.

### Step 6: Deploy and Test

1. **Automatic Deployment**: Railway will automatically deploy when you push to GitHub
2. **Monitor Logs**: Check the deployment logs in Railway dashboard
3. **Get Your URL**: Railway will provide a URL like `https://your-app-name.railway.app`
4. **Test the App**: Visit your URL and test all functionality

## üîß Post-Deployment Configuration

### Custom Domain (Optional)

1. **In Railway Dashboard**: Go to "Settings" ‚Üí "Domains"
2. **Add Custom Domain**: Enter your domain name
3. **Configure DNS**: Point your domain to Railway's servers
4. **SSL Certificate**: Railway automatically provides HTTPS

### Database Management

1. **Access Database**: Use Railway's built-in database browser
2. **Backup**: Railway provides automatic backups
3. **Scaling**: Upgrade database plan as needed

### Monitoring and Logs

1. **View Logs**: Railway dashboard ‚Üí "Deployments" ‚Üí "View Logs"
2. **Metrics**: Monitor CPU, memory, and request metrics
3. **Alerts**: Set up notifications for issues

## üö® Important Configuration Notes

### 1. RunPod Connection
Make sure your RunPod RTX 5090 instance is:
- ‚úÖ Running and accessible
- ‚úÖ ComfyUI server started on port 8188
- ‚úÖ Proxy URL working (test with browser)

### 2. Database Migration
On first deployment, Railway will automatically:
- Create all database tables
- Set up the admin user (ascendbase@gmail.com / morphpas)
- Initialize the database schema

### 3. File Storage
Railway provides persistent storage for:
- Uploaded images (`uploads/` folder)
- Generated results (`outputs/` folder)
- Database files

### 4. Security Settings
- Gmail-only registration is active
- Admin user blocking functionality enabled
- Crypto-only payments configured
- All security measures in place

## üéâ Testing Your Deployment

### 1. Basic Functionality Test
1. **Visit your Railway URL**
2. **Register with Gmail account**
3. **Login and access dashboard**
4. **Upload test image**
5. **Run face morphing generation**
6. **Download result**

### 2. Admin Panel Test
1. **Login as admin**: ascendbase@gmail.com / morphpas
2. **Access admin dashboard**: `/admin`
3. **Test user management**
4. **Test payment approval**
5. **Test user blocking**

### 3. Payment System Test
1. **Buy credits page**
2. **Crypto payment options**
3. **Payment status tracking**
4. **Admin payment approval**

## üí∞ Railway Pricing

### Free Tier:
- **$5 free credits** per month
- **500 hours** of usage
- **1GB RAM** per service
- **1GB storage**

### Paid Plans:
- **$5/month** after free credits
- **Unlimited usage**
- **Up to 8GB RAM**
- **100GB storage**

## üîç Troubleshooting

### Common Issues:

#### 1. Database Connection Error
```bash
# Check DATABASE_URL is set correctly
# Verify PostgreSQL service is running
```

#### 2. RunPod Connection Failed
```bash
# Verify RUNPOD_POD_URL is correct
# Check RunPod instance is running
# Test proxy URL in browser
```

#### 3. File Upload Issues
```bash
# Check file permissions
# Verify upload folder exists
# Check file size limits
```

#### 4. Admin Access Issues
```bash
# Verify admin user was created
# Check email: ascendbase@gmail.com
# Check password: morphpas
```

### Getting Help:
1. **Railway Docs**: [docs.railway.app](https://docs.railway.app)
2. **Railway Discord**: Community support
3. **GitHub Issues**: Check your repository issues
4. **Logs**: Always check Railway deployment logs first

## üéØ Success Checklist

- [ ] Repository pushed to GitHub
- [ ] Railway project created
- [ ] PostgreSQL database added
- [ ] Environment variables configured
- [ ] App deployed successfully
- [ ] Database tables created
- [ ] Admin user accessible
- [ ] RunPod connection working
- [ ] Face morphing generation working
- [ ] Payment system functional
- [ ] Admin panel accessible
- [ ] Custom domain configured (optional)

## üöÄ You're Live!

Once deployed, your Face Morphing SaaS will be accessible at:
`https://your-app-name.railway.app`

**Features Available:**
- ‚úÖ Gmail-only user registration
- ‚úÖ Tier-based face morphing (10%-25% denoise)
- ‚úÖ Credit system with free daily generation
- ‚úÖ Crypto payment processing
- ‚úÖ Admin user management and blocking
- ‚úÖ RTX 5090 GPU processing
- ‚úÖ Professional minimalistic UI
- ‚úÖ Payment status tracking
- ‚úÖ Comprehensive admin dashboard

Your Face Morphing SaaS is now ready for production use! üéâ